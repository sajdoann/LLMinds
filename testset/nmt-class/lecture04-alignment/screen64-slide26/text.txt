 If you want some summarization of the trick, this is the target sentence, this is the source sentence. In one of the calculations you are considering the sum of all pairs, so all the full graph. And that full graph, the sum of all the pairs, where each pair is a multiplication of the things, that can be regrouped into a product of summations.